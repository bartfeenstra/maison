events {
    worker_connections 4096;
}

http {
    #server {
    #    listen 80;
    #    server_name *.bartfeenstra.com;
    #    return 301 https://$host$uri;
    #}

    server {
        server_name maison.bartfeenstra.com;

        include /etc/nginx/server-common-ssl.conf;

        # The Unifi controller software.
        location /network {
            include /etc/nginx/location-proxy-common.conf;
            rewrite ^/network(.*) $1 break;
            proxy_set_header Host $host/network;
            proxy_pass http://localhost:8080;
        }

        # OLA.
        location /ola/ {
            include /etc/nginx/location-proxy-common.conf;
            rewrite ^/ola/(.*) /$1 break;
            proxy_set_header Host $host/ola;
            proxy_pass http://ola:9090;
        }

        # OpenHab.
        location /home {
            include /etc/nginx/location-proxy-common.conf;
            rewrite ^/home/?(.*) /$1 break;
            proxy_set_header Host $host/home;
            proxy_pass http://openhab:8081;
        }
        # The org.eclipse.smarthome.io.rest package overrides its configured root URL with its own value ("/rest") on
        # every boot, so we redirect requests to this generated, hardcoded URL to the actual location at "/home/rest".
        location /rest {
            rewrite ^/rest/?(.*) /home/rest/$1 last;
        }

        location = / {
            return 301 $scheme://$host/home;
        }
    }
}