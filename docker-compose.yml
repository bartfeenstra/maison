version: '3.4'
services:
  db:
    image: 'mariadb:10.2'
    restart: on-failure
    ports:
     - '3306:3306'
    volumes:
      - './db/data:/var/lib/mysql'
      - './db/conf:/etc/mysql/conf.d'
    networks:
      maison:
        aliases:
          - db
  openhab:
    image: 'openhab/openhab:2.2.0-amd64-debian'
    restart: on-failure
    tty: true
    volumes:
      - '/etc/localtime:/etc/localtime:ro'
      - '/etc/timezone:/etc/timezone:ro'
      - './openhab/addons:/openhab/addons'
      - './openhab/conf:/openhab/conf'
      - './openhab/userdata:/openhab/userdata'
    ports:
     - "8080:8080"
    networks:
      - maison
    environment:
      OPENHAB_HTTP_PORT: '8080'
      OPENHAB_HTTPS_PORT: '8443'
    depends_on:
      - db
  ola:
    image: ola:ola
    build: ./ola
    restart: on-failure
    expose:
     - "9010"
     - "9090"
    ports:
     - "9090:9090"
    networks:
      maison:
        aliases:
          - ola
    # The FTDI USB device we need can be (un)mounted at any time, and as any /dev/ttyUSB* device. Because we trust this
    # container, we run it in privileged mode and allow access to any device, so we can choose the right one runtime.
    privileged: true
  nginx:
    image: maison:nginx
    build: ./nginx
    expose:
     - "80"
     - "443"
    ports:
     - "80:80"
     - "443:443"
#    depends_on:
#      - certbot
    networks:
      - maison
#  certbot:
#    image: maison:certbot
#    build: ./certbot
#    networks:
#      maison:
#        aliases:
#          - certbot
networks:
  maison:
