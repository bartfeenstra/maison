#!/usr/bin/env bash

set -Eeuo pipefail

cd "$(dirname "$0")/.."

ensure_env_mode() {
    chmod u=rw,go= .env
}

if [ ! -f ./.env ]; then
    ./bin/generate-env-passwords .env.dist > .env
    ensure_env_mode
    ./vendor/krab/bin/krab stdio-inform "A new configuration file with random passwords has been saved to $(readlink -f ./.env). Fill in the remaining settings, and run this command (./bin/build) again to finish the build."
    exit 1
fi
ensure_env_mode
